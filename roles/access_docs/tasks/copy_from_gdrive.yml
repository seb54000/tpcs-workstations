- name: pip install gdrive dependencies
  ansible.builtin.pip:
    name:
      - google-api-python-client
      - google-auth-httplib2
      - google-auth-oauthlib
    state: present

- name: Template and Copy gdrive python script
  ansible.builtin.template:
    src: gdrive/gdrive.py.j2
    dest: /var/tmp/gdrive.py
    owner: root
    group: root
    mode: '0644'

- name: Create file token.json
  ansible.builtin.copy:
    content: "{{ token_gdrive }}"
    dest: /var/tmp/token.json
    owner: root
    group: root
    mode: '0644'

- name: Run gdrive.py script
  ansible.builtin.command: python3 /var/tmp/gdrive.py
  register: gdrive_result

- name: Delete token.json
  ansible.builtin.file:
    name: /var/tmp/token.json
    state: absent

- name: Debug script #TODO : remove when finished
  ansible.builtin.debug:
    var: gdrive_result